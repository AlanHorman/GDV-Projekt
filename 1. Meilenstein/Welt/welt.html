<html>
	<head>
		<title>Nimmersatts Welt</title>
	</head>
	
	<body>
		<script src="..\..\Application\page\extern\three_js\build\three.min.js">
		</script>
		<script src="..\..\Application\page\extern\three_x\THREEx.FullScreen.js"></script>
		<script src="..\..\Application\page\extern\three_x\threex.keyboardstate.js"></script>
		<script src="..\..\Application\page\extern\three_x\threex.videoteexture.js"></script>
		<script>
		
			// Globale Variable für die SetIntervall-Funktion
			var seconds  = 60;
			var ding = new Audio("Taito_Carousel.wav");
			var cameraTransVect = new THREE.Vector3(0, 50, 0);
			var cameraRotVect = new THREE.Vector3(-1.57, 0, 0);
			
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			var geometry1 = new THREE.PlaneGeometry(250, 100);
			var material1 = new THREE.MeshBasicMaterial( { color: "rgb(145, 142, 145)", side: THREE.DoubleSide} );
			var floor = new THREE.Mesh( geometry1, material1 );
			
			var geometry2 = new THREE.BoxGeometry(70, 35, 2);
			var material2 = new THREE.MeshPhongMaterial({map : THREE.ImageUtils.loadTexture("Holz_Texturs_B_03921.jpg")});
			var soil = new THREE.Mesh( geometry2, material2 );
			
			var geometry3 = new THREE.BoxGeometry(70, 14, 1);
			var material3 = new THREE.MeshBasicMaterial({color: "rgb(10, 10, 10)"});
			var wall1 = new THREE.Mesh(geometry3, material3);
			var wall2 = new THREE.Mesh(geometry3, material3);
			
			var geometry4 = new THREE.BoxGeometry(1, 14, 35);
			var material4 = new THREE.MeshBasicMaterial({color: "rgb(34, 34, 34)"});
			var wall3 = new THREE.Mesh(geometry4, material4);
			var wall4 = new THREE.Mesh(geometry4, material4);
			
			var geometry5 = new THREE.CylinderGeometry(0, 1, 3);
			var material5 = new THREE.MeshPhongMaterial({ color: "#006600", specular: "#00FF00", shininess: 30, shading: THREE.SmoothShading });
			var food = new THREE.Mesh(geometry5, material5);

			var spotLight = new THREE.SpotLight( 0xffffff );
				spotLight.position.set( 100, 100, 100 );

				spotLight.castShadow = true;

				spotLight.shadowMapWidth = 1024;
				spotLight.shadowMapHeight = 1024;

				spotLight.shadowCameraNear = 500;
				spotLight.shadowCameraFar = 4000;
				spotLight.shadowCameraFov = 30;

				scene.add( spotLight );

	/// Code für die Steuerung!!!		
				var updateFcts	= [];


        //hinzufügen der Objekte
	
	var geometry	= new THREE.CubeGeometry( 3, 3, 3);
	var material	= new THREE.MeshPhongMaterial({ color: "#F5B800", specular: "#FFCC33", shininess: 30, shading: THREE.FlatShading });
	var snake = new THREE.Mesh( geometry, material );
	
        scene.add( snake );
		
		snake.position.y = 3;
		food.position.y = 3;

		// tastaturbewegung
	
	var keyboard	= new THREEx.KeyboardState(renderer.domElement);
	renderer.domElement.setAttribute("tabIndex", "0");
	renderer.domElement.focus();
	
	updateFcts.push(function(){
		if( keyboard.pressed('left') ){
			snake.position.x -= 1;			
		}else if( keyboard.pressed('right') ){
			snake.position.x += 1;
		}
		if( keyboard.pressed('down') ){
			snake.position.z += 1;		
		}else if( keyboard.pressed('up') ){
			snake.position.z -= 1;		
		}
	})

	//render
	updateFcts.push(function(){
		renderer.render( scene, camera );		
	})

	//loop runner
	var lastTimeMsec= null
	requestAnimationFrame(function animate(nowMsec){
            // keep looping
            requestAnimationFrame( animate );
            // measure time
            lastTimeMsec	= lastTimeMsec || nowMsec-1000/60
            var deltaMsec	= Math.min(200, nowMsec - lastTimeMsec)
            lastTimeMsec	= nowMsec
	
        // call each update function
            updateFcts.forEach(function(updateFn){
            updateFn(deltaMsec/1000, nowMsec/1000)
            })
	})
	
	
	///Ende vom Code der Steuerung!!!
	
			function setFood(a, b)
			{
				var posit = [];
				
				if (a == undefined)
					a = Math.floor(Math.random() * 2);
					
				if (b == undefined)
					b = Math.floor(Math.random() * 2);
					
				if (a == 0)
					posit[0] = Math.floor(Math.random() * 31);
				else
					posit[0] = Math.floor(Math.random() * -31);
					
				if (b == 0)
					posit[1] = Math.floor(Math.random() * 16);
				else
					posit[1] = Math.floor(Math.random() * -16);
				
				food.position.x = posit[0];
				food.position.z = posit[1];
				
				return posit;
			}		

			setFood();
						
			scene.add(soil);
			scene.add(floor);
			scene.add(wall1);
			scene.add(wall2);
			scene.add(wall3);
			scene.add(wall4);
			scene.add(food);
			
						
			floor.rotation.x = -1.57;
			soil.rotation.x = -1.57;
			soil.position.y = 1;
			wall1.position.z = -18;
			wall2.position.z = 18;
			wall3.position.x = 34.5;
			wall4.position.x = -34.5;
		
			

			camera.rotation.x = cameraRotVect.x;
			camera.position.y = cameraTransVect.y;
				
			var render = function () {
				requestAnimationFrame( render );
				renderer.render(scene, camera);
				renderer.setSize(window.innerWidth, window.innerHeight);
			};
			render();
			
function changeCameraTrans(t1, t2, t3)
			{
				cameraTransVect.negate();
				camera.position.x += cameraTransVect.x;
				camera.position.y += cameraTransVect.y;
				camera.position.z += cameraTransVect.z;
							
				cameraTransVect.set(t1, t2, t3);
							
				camera.position.x = cameraTransVect.x;
				camera.position.y = cameraTransVect.y;
				camera.position.z = cameraTransVect.z;
			}

			function changeCameraRot(r1, r2, r3)
			{				
				cameraRotVect.negate();
				camera.rotation.x += cameraRotVect.x;
				camera.rotation.y += cameraRotVect.y;
				camera.rotation.z += cameraRotVect.z;
							
				cameraRotVect.set(r1, r2, r3);
														
				camera.rotation.x = cameraRotVect.x;
				camera.rotation.y = cameraRotVect.y;
				camera.rotation.z = cameraRotVect.z;
			}
			
			document.body.addEventListener("keydown", function (event)
			{
				switch (event.keyCode)
				{
					case 71:
					// G
							THREEx.FullScreen.request();
							break;
					case 74:
					// J
							changeCameraTrans(0, 50, 0);
							changeCameraRot(-1.57, 0, 0);
							break;
					case 77:
					// M
							changeCameraTrans(0, 25, 25);
							changeCameraRot(-0.9, 0, 0);
							break;
					default:
				}
			});
			

			
			
			
		</script>
	</body>
</html>